# CoachBase GraphQL Schema
# A comprehensive sports coaching platform with AI-powered training insights
# This schema defines all entities, queries, mutations, and subscriptions for the platform

# Custom scalar types for date/time handling and flexible JSON data
scalar DateTime
scalar JSON

"""
Coach entity representing the authenticated user/coach who owns athletes and training data.
Abstracts the traditional user model and stores core profile and account information.
The user_id field references the Supabase auth user UUID.
"""
type Coach {
	id: ID!
	userId: ID! # Supabase auth user UUID
	email: String!
	firstName: String
	lastName: String
	displayName: String # Computed or custom display name
	avatar: String # Profile picture URL
	timezone: String # Coach's timezone for scheduling

	# Account management
	accountStatus: AccountStatus! # Account state (active, suspended, etc.)
	onboardingCompleted: Boolean! # Whether initial setup is done
	lastLoginAt: DateTime # Last successful login
	createdAt: DateTime!
	updatedAt: DateTime!
	deletedAt: DateTime # Soft delete timestamp

	# Relationships
	billing: CoachBilling # Billing and subscription information
	athletes: [Athlete!]! # Athletes owned by this coach
	trainingPlans: [TrainingPlan!]! # Training plans created by this coach
}

"""
CoachBilling entity managing subscription, billing, and usage tracking for coaches.
Separated from Coach entity to maintain clean separation of concerns.
Integrated with Stripe for payment processing and subscription management.
"""
type CoachBilling {
	id: ID!
	coachId: ID! # Foreign key to Coach

	# Stripe integration
	stripeCustomerId: String # Stripe customer ID for billing
	subscriptionStatus: SubscriptionStatus! # Current subscription state
	subscriptionTier: SubscriptionTier! # Current plan level
	subscriptionStartDate: DateTime # When current subscription started
	subscriptionEndDate: DateTime # When current subscription ends/renews
	trialEndDate: DateTime # Free trial end date
	billingEmail: String # Billing email if different from main email

	# Usage tracking and limits
	monthlyAthleteLimit: Int! # Max athletes allowed per month
	currentAthleteCount: Int! # Current number of active athletes
	monthlySessionLogLimit: Int! # Max session logs allowed per month
	currentSessionLogCount: Int! # Current session logs this month
	aiCreditsRemaining: Int # AI feature usage credits
	usageResetDate: DateTime! # When usage counters were last reset

	# Billing history and metadata
	lastPaymentDate: DateTime # Last successful payment
	nextBillingDate: DateTime # Next billing cycle date
	billingCycleDay: Int # Day of month for billing (1-28)
	currency: String! # Currency code (USD, EUR, etc.)

	createdAt: DateTime!
	updatedAt: DateTime!
	deletedAt: DateTime # Soft delete timestamp
}

"""
Subscription status indicating the current state of the coach's billing subscription.
"""
enum SubscriptionStatus {
	TRIAL # Free trial period
	ACTIVE # Paid subscription is active and current
	PAST_DUE # Payment failed, grace period
	CANCELED # Subscription cancelled, access until period end
	UNPAID # Payment failed, access suspended
	INCOMPLETE # Subscription setup incomplete
	INCOMPLETE_EXPIRED # Incomplete subscription expired
	PAUSED # Subscription temporarily paused
}

"""
Subscription tier indicating the coach's current plan level and feature access.
"""
enum SubscriptionTier {
	FREE # Free tier with basic features
	STARTER # Basic paid plan
	PROFESSIONAL # Professional plan with advanced features
}

"""
Account status indicating the overall state of the coach's account.
"""
enum AccountStatus {
	ACTIVE # Account is active and in good standing
	SUSPENDED # Account temporarily suspended
	BANNED # Account permanently banned
	PENDING_VERIFICATION # Account awaiting email/identity verification
	INCOMPLETE # Account setup not finished
}

"""
AI Assistant entity representing coaching specialists for different sports and roles.
Assistants provide AI-powered insights and generate training content based on their expertise.
"""
type Assistant {
	id: ID!
	name: String!
	sport: String! # The sport this assistant specializes in
	role: String! # The specific role/focus area (e.g., "Strength Coach", "Technical Coach")
	strengths: [String!]! # Key areas of expertise
	bio: String! # Assistant's background and experience description
	promptTemplate: String! # AI prompt template used for generating content
	createdAt: DateTime!
	updatedAt: DateTime!
	deletedAt: DateTime # Soft delete timestamp
}

"""
Athlete entity representing individuals receiving coaching.
Contains personal information, physical attributes, and relationships to goals, sessions, and training plans.
All athlete data is automatically scoped to the authenticated coach's user account.
"""
type Athlete {
	userId: ID! # ID of the coach who owns this athlete record
	id: ID!
	birthday: String # Date of birth for age calculations and program planning
	gender: String # Gender information for training considerations
	fitnessLevel: String # Current fitness assessment (beginner, intermediate, advanced)
	trainingHistory: String # Previous training background and experience
	height: Float # Height in centimeters
	weight: Float # Weight in kilograms
	firstName: String!
	lastName: String!
	email: String!
	tags: [String!] # Custom tags for categorization and filtering
	notes: String # General notes about the athlete
	sport: String! # Primary sport focus
	createdAt: DateTime!
	updatedAt: DateTime!
	deletedAt: DateTime # Soft delete timestamp
	# Relationships
	goals: [Goal!] # Associated training goals
	sessionLogs: [SessionLog!] # Training session records
	trainingPlans: [TrainingPlan!]! # Structured training programs
}

"""
Goal entity representing specific training objectives for athletes.
Goals can be linked to multiple session logs and training plans for comprehensive tracking.
"""
type Goal {
	id: ID!
	athlete: Athlete! # The athlete this goal belongs to
	title: String! # Short, descriptive goal title
	description: String # Detailed goal description and context
	status: GoalStatus! # Current goal status
	createdAt: DateTime!
	updatedAt: DateTime!
	deletedAt: DateTime # Soft delete timestamp
	dueDate: DateTime # Target completion date
	progressNotes: String # Coach notes on progress toward the goal
	sport: String # Sport-specific classification
	evaluationResponse: JSON
	# Relationships
	sessionLogs: [SessionLog!]! # Sessions that worked toward this goal
	trainingPlans: [TrainingPlan!] # Training plans that include this goal
}

"""
Goal lifecycle status indicating current state and progress.
"""
enum GoalStatus {
	ACTIVE # Goal is currently being worked on
	COMPLETED # Goal has been successfully achieved
	PAUSED # Goal is temporarily on hold
}

"""
SessionLog entity representing individual training session records.
Captures session details, progress notes, and AI-generated insights.
Note: Called "SessionLog" instead of "Session" to avoid confusion with authentication sessions.
"""
type SessionLog {
	id: ID!
	athlete: Athlete! # The athlete this session belongs to
	date: DateTime! # When the session took place
	notes: String # Coach's notes about the session
	transcript: String # Raw session transcript or detailed notes
	summary: String # AI-generated summary of the session
	actionItems: [String!] # AI-generated action items and next steps
	goals: [Goal!]! # Goals that were worked on during this session
	aiMetadata: AIMetadata # Metadata about AI processing status
	createdAt: DateTime!
	updatedAt: DateTime!
	deletedAt: DateTime # Soft delete timestamp
}

"""
Metadata tracking AI processing status for session logs.
Used to track which AI features have been applied to avoid duplicate processing.
"""
type AIMetadata {
	summaryGenerated: Boolean! # Whether AI summary has been generated
	nextStepsGenerated: Boolean! # Whether AI action items have been generated
}

"""
TrainingPlan entity representing structured, AI-generated training programs for athletes.
Plans are created by AI assistants based on specific goals and can include detailed schedules,
exercises, and progression tracking. Plans support real-time generation status updates.
"""
type TrainingPlan {
	id: ID!
	athlete: Athlete! # Athlete relationship
	goals: [Goal!] # Multiple goals this plan addresses
	assistants: [Assistant!] # AI assistants that contributed to plan generation
	createdAt: String!
	updatedAt: String!
	startDate: String # When the training plan should begin
	endDate: String # When the training plan should conclude
	notes: String # Coach notes about the plan
	planJson: JSON # Structured plan data (exercises, schedules, etc.)
	overview: String # High-level plan description and objectives
	sourcePrompt: String # Original prompt used to generate the plan
	generatedBy: String # ID of the Assistant that generated the plan content
	"""
	The current status of the training plan, reflecting its lifecycle and generation state.
	"""
	status: TrainingPlanStatus!
}

"""
Training plan lifecycle status indicating generation progress and readiness.
Used for real-time updates during AI generation process.
"""
enum TrainingPlanStatus {
	DRAFT # Plan created but content not yet generated
	GENERATING # AI is currently generating plan content
	GENERATED # Plan generation completed successfully
	ERROR # Plan generation failed or encountered errors
}

# Input types for filtering and searching

"""
Filter criteria for finding assistants based on sport, role, and expertise.
"""
input AssistantsFilter {
	sport: String! # Required sport filter
	role: String # Optional specific role filter
	strengths: [String] # Optional strengths/expertise filter
}

"""
Input wrapper for assistant queries with optional filtering.
"""
input AssistantsInput {
	filter: AssistantsFilter # Optional filter criteria
}

# Query operations for data retrieval

"""
Root query type providing read access to all platform entities.
All queries are automatically scoped to the authenticated coach's data.
"""
type Query {
	# Coach queries
	me: Coach # Get current authenticated coach profile
	coach(id: ID!): Coach # Get specific coach by ID (admin only)

	# Assistant queries
	assistants(input: AssistantsInput): [Assistant]! # Get assistants with optional filtering

	# Athlete queries
	athletes: [Athlete!]! # Get all athletes for the authenticated coach
	athlete(id: ID!): Athlete # Get specific athlete by ID

	# Goal queries
	goals(athleteId: ID!): [Goal!]! # Get all goals for a specific athlete
	goal(id: ID!, athleteId: ID!): Goal # Get specific goal by ID and athlete

	# Session log queries
	sessionLogs(athleteId: ID!): [SessionLog!]! # Get all session logs for an athlete
	sessionLog(id: ID!): SessionLog # Get specific session log by ID

	# Training plan queries
	trainingPlan(id: ID!): TrainingPlan # Get specific training plan by ID
	trainingPlans(athleteId: ID): [TrainingPlan!]! # Get training plans, optionally filtered by athlete
}

# Input types for entity creation and updates

"""
Input for creating a new coach profile during onboarding.
Called automatically after successful authentication.
"""
input CreateCoachInput {
	firstName: String
	lastName: String
	displayName: String
	timezone: String
	billingEmail: String
}

"""
Input for updating coach profile information.
All fields are optional - only provided fields will be updated.
"""
input UpdateCoachInput {
	firstName: String
	lastName: String
	displayName: String
	avatar: String
	timezone: String
	onboardingCompleted: Boolean
}

"""
Input for updating coach billing information.
Typically called by Stripe webhooks or billing management system.
"""
input UpdateCoachBillingInput {
	stripeCustomerId: String
	subscriptionStatus: SubscriptionStatus
	subscriptionTier: SubscriptionTier
	subscriptionStartDate: DateTime
	subscriptionEndDate: DateTime
	trialEndDate: DateTime
	billingEmail: String
	monthlyAthleteLimit: Int
	monthlySessionLogLimit: Int
	aiCreditsRemaining: Int
	lastPaymentDate: DateTime
	nextBillingDate: DateTime
	billingCycleDay: Int
	currency: String
}

"""
Input for creating a new athlete record.
All fields are validated and the athlete is automatically associated with the authenticated coach.
"""
input CreateAthleteInput {
	firstName: String!
	lastName: String!
	birthday: DateTime! # Required for age-appropriate training planning
	email: String! # Required for communication
	tags: [String!] # Optional categorization tags
	notes: String # Optional general notes
	sport: String! # Required primary sport focus
}

"""
Input for updating an existing athlete record.
All fields are optional - only provided fields will be updated.
"""
input UpdateAthleteInput {
	firstName: String
	lastName: String
	email: String
	tags: [String!] # Replaces existing tags entirely
	notes: String
	sport: String
}

"""
Input for creating a new goal for an athlete.
Goals are automatically associated with the specified athlete and authenticated coach.
"""
input CreateGoalInput {
	athleteId: ID! # The athlete this goal belongs to
	title: String! # Required descriptive title
	description: String # Optional detailed description
	dueDate: DateTime # Optional target completion date
	sport: String! # Required sport classification
}

"""
Input for updating an existing goal.
All fields are optional - only provided fields will be updated.
"""
input UpdateGoalInput {
	title: String
	description: String
	dueDate: DateTime
	status: GoalStatus # Update goal progress status
	progressNotes: String # Coach notes on progress
	sport: String
	trainingPlanIds: [ID!] # Associate goal with training plans
}

"""
Input for creating a new session log entry.
Session logs capture training session details and progress toward goals.
"""
input CreateSessionLogInput {
	athleteId: ID! # The athlete this session belongs to
	date: DateTime! # Required session date
	notes: String # Optional coach notes
	transcript: String # Optional detailed session transcript
	goalIds: [ID!] # Optional goals addressed in this session
}

"""
Input for updating an existing session log.
Supports both manual updates and AI-generated content addition.
"""
input UpdateSessionLogInput {
	notes: String # Coach notes
	transcript: String # Session transcript
	goalIds: [ID!] # Goals addressed in session (replaces existing)
	summary: String # AI-generated or manual summary
	actionItems: [String!] # AI-generated or manual action items
}

# AI-powered input types for intelligent features

"""
Input for triggering AI summarization of a session log.
Generates summary and action items using AI analysis of session content.
"""
input AISummarizeSessionLogInput {
	sessionLogId: ID! # The session log to summarize
}

"""
Input for creating a new training plan.
Plan content will be generated by AI based on specified goals and assistant expertise.
"""
input CreateTrainingPlanInput {
	athleteId: ID! # The athlete this plan is for
	assistantIds: [ID!] # AI assistants to use for plan generation
	goalIds: [ID!] # Goals this plan should address
}

"""
Input for AI training plan generation.
Creates suggested training plan content based on athlete goals and historical data.
"""
input AIGenerateTrainingPlanInput {
	athleteId: ID! # The athlete to generate a session for
	goalIds: [ID!]! # Goals to focus on in the session
}


"""
Input for AI goal extraction and evaluation from natural language.
Processes goal text and provides structured evaluation and recommendations.
"""
input AIExtractAndEvaluateGoalInput {
	athleteId: ID! # The athlete the goal is for
	goalText: String! # Natural language goal description to analyze
}

"""
Input for AI longitudinal pattern analysis across session logs.
Analyzes patterns and trends across multiple session logs to identify insights.
"""
input AIAnalyzeSessionPatternsInput {
	athleteId: ID! # The athlete to analyze
	startDate: DateTime! # Analysis period start date
	endDate: DateTime! # Analysis period end date
	goalIds: [ID!] # Optional filter for specific goals
}

# AI Goal Evaluation Response Types
# These types represent the structured output from AI goal analysis

"""
Comprehensive response from AI goal extraction and evaluation.
Provides detailed analysis, scoring, and recommendations for goal refinement.
"""
type GoalEvaluationResponse {
	coreGoal: CoreGoal! # Extracted core goal information
	goalEvaluation: GoalEvaluation! # Detailed goal scoring and analysis
	refinedGoalSuggestion: RefinedGoalSuggestion! # AI recommendations for improvement
	timeline: Timeline! # Timeline analysis and planning
	motivation: Motivation! # Motivational factors and drivers
	availability: Availability! # Resource and schedule availability
	constraints: Constraints! # Limitations and challenges
	successIndicators: SuccessIndicators! # Success measurement criteria
	extractionConfidence: ExtractionConfidence! # AI confidence in analysis
	coachingFeedback: CoachingFeedback! # Coach-specific insights and recommendations
}

"""
Core goal information extracted from natural language input.
Represents the fundamental objective and sport context.
"""
type CoreGoal {
	type: String! # Goal category (performance, skill development, etc.)
	primaryObjective: String! # Main goal statement
	sport: String! # Sport context
	measurableOutcome: String # Specific measurable target if identified
}

"""
Detailed scoring and evaluation of goal quality across multiple dimensions.
Each score is typically 1-10 scale with 10 being highest quality.
"""
type GoalEvaluation {
	overallQualityScore: Int! # Overall goal quality assessment
	specificityScore: Int! # How specific and clear the goal is
	feasibilityScore: Int! # How achievable the goal appears
	relevanceScore: Int! # How relevant to athlete's sport/context
	timeStructureScore: Int! # How well-defined the timeline is
	motivationScore: Int! # How motivating/engaging the goal appears
	evaluationSummary: EvaluationSummary! # Detailed breakdown of assessment
}

"""
Detailed breakdown of goal evaluation highlighting key areas.
"""
type EvaluationSummary {
	strengths: [String!]! # Positive aspects of the goal
	weaknesses: [String!]! # Areas needing improvement
	riskFactors: [String!]! # Potential challenges or obstacles
	improvementPriorities: [String!]! # Most important areas to address
}

"""
AI-generated suggestions for improving the goal statement.
"""
type RefinedGoalSuggestion {
	improvedGoalStatement: String # Suggested improved goal text
	keyChanges: [String!]! # List of specific changes made
	rationale: String! # Explanation of why changes were suggested
}

"""
Timeline analysis and planning information for the goal.
"""
type Timeline {
	targetDate: String # Suggested or extracted target completion date
	duration: String # Expected time to achieve goal
	urgencyLevel: UrgencyLevel! # How urgent/time-sensitive the goal is
	milestones: [String!]! # Suggested intermediate milestones
}

"""
Urgency classification for goal timeline planning.
"""
enum UrgencyLevel {
	IMMEDIATE # Needs attention within days/weeks
	SHORT_TERM # 1-3 months
	MEDIUM_TERM # 3-12 months
	LONG_TERM # Over 1 year
}

"""
Motivational factors and emotional context driving the goal.
"""
type Motivation {
	whyItMatters: String! # Core reason why this goal is important
	externalDrivers: [String!]! # External factors motivating the goal
	emotionalContext: String! # Emotional significance and personal meaning
	supportSystem: [String!]! # People/resources available for support
}

"""
Resource availability and practical constraints for goal achievement.
"""
type Availability {
	trainingTime: String # Available time for training per week
	scheduleConstraints: [String!]! # Schedule limitations and conflicts
	location: String # Available training locations/facilities
	equipment: [String!]! # Available equipment and resources
	budget: String # Budget considerations for training
}

"""
Limitations and challenges that may impact goal achievement.
"""
type Constraints {
	physicalLimitations: [String!]! # Physical restrictions or injuries
	experienceLevel: ExperienceLevel! # Current skill/experience level
	previousChallenges: [String!]! # Past obstacles and difficulties
	riskFactors: [String!]! # Potential risks or concerns
}

"""
Experience level classification for training planning.
"""
enum ExperienceLevel {
	BEGINNER # New to the sport/activity
	INTERMEDIATE # Some experience and skill development
	ADVANCED # High skill level and experience
	RETURNING # Previously experienced but returning after break
}

"""
Success measurement criteria and expected outcomes.
"""
type SuccessIndicators {
	measurementMethods: [String!]! # How progress/success will be measured
	successDefinition: String! # Clear definition of goal achievement
	secondaryBenefits: [String!]! # Additional benefits beyond main goal
}

"""
AI confidence assessment and information gaps in goal analysis.
"""
type ExtractionConfidence {
	overallConfidence: ConfidenceLevel! # Overall confidence in analysis
	missingInformation: [String!]! # Key information not provided
	assumptions: [String!]! # Assumptions made by AI in analysis
	suggestedQuestions: [String!]! # Questions to clarify unclear aspects
}

"""
Confidence level in AI analysis and recommendations.
"""
enum ConfidenceLevel {
	HIGH # Very confident in analysis
	MEDIUM # Moderately confident
	LOW # Low confidence, more info needed
}

"""
Coach-specific feedback and development insights.
"""
type CoachingFeedback {
	dataQuality: DataQuality! # Quality of information provided
	keyGapsIdentified: [String!]! # Important missing information
	improvementSuggestions: [String!]! # Specific recommendations for coaches
	riskFlags: [String!]! # Warning flags requiring attention
	coachDevelopmentInsight: String! # Insights for coach development
}

"""
Assessment of data quality for coaching analysis.
"""
enum DataQuality {
	EXCELLENT # Comprehensive, detailed information
	GOOD # Sufficient information for analysis
	LIMITED # Some gaps but workable
	INSUFFICIENT # Too little information for proper analysis
}

"""
Input for updating an existing training plan.
All fields are optional - only provided fields will be updated.
"""
input UpdateTrainingPlanInput {
	title: String # Plan title/name
	overview: String # Plan overview description
	assistantIds: [ID!] # Update associated AI assistants
	goalIds: [ID!] # Update associated goals
}

# Mutation operations for data modification

"""
Root mutation type providing write access to all platform entities.
All mutations are automatically scoped to the authenticated coach's data.
Includes both standard CRUD operations and AI-powered features.
"""
type Mutation {
	# Coach mutations
	createCoach(input: CreateCoachInput!): Coach! # Create coach profile (onboarding)
	updateCoach(input: UpdateCoachInput!): Coach! # Update coach profile
	updateCoachBilling(input: UpdateCoachBillingInput!): CoachBilling! # Update billing information (webhooks)

	# Athlete mutations
	createAthlete(input: CreateAthleteInput!): Athlete! # Create new athlete
	updateAthlete(id: ID!, input: UpdateAthleteInput!): Athlete! # Update athlete details
	deleteAthlete(id: ID!): Boolean! # Soft delete athlete (sets deleted_at)

	# Goal mutations
	createGoal(input: CreateGoalInput!): Goal! # Create new goal for athlete
	updateGoal(id: ID!, input: UpdateGoalInput!): Goal! # Update goal details and status
	deleteGoal(id: ID!): Boolean! # Soft delete goal

	# Session log mutations
	createSessionLog(input: CreateSessionLogInput!): SessionLog! # Create new session record
	updateSessionLog(id: ID!, input: UpdateSessionLogInput!): SessionLog! # Update session details
	deleteSessionLog(id: ID!): Boolean! # Soft delete session log

	# Training plan mutations
	createTrainingPlan(input: CreateTrainingPlanInput!): TrainingPlan! # Create new training plan (triggers AI generation)
	updateTrainingPlan(id: ID!, input: UpdateTrainingPlanInput!): TrainingPlan! # Update plan metadata

	# AI-powered mutations
	summarizeSessionLog(input: AISummarizeSessionLogInput!): SessionLog! # Generate AI summary for session
	generateTrainingPlan(input: AIGenerateTrainingPlanInput!): TrainingPlan! # Generate AI training plan
	analyzeSessionPatterns(input: AIAnalyzeSessionPatternsInput!): String! # Analyze patterns across session logs
	extractAndEvaluateGoal(
		input: AIExtractAndEvaluateGoalInput!
	): GoalEvaluationResponse! # AI goal analysis and evaluation
}

# Real-time subscription operations

"""
Root subscription type providing real-time updates for platform entities.
Subscriptions enable live updates in the UI during AI processing and data changes.
All subscriptions are automatically scoped to the authenticated coach's data.
"""
type Subscription {
	# Training plan subscriptions
	trainingPlanGenerated(athleteId: ID!): TrainingPlan! # Real-time updates during AI plan generation

	# Session log subscriptions
	sessionLogAdded(athleteId: ID!): SessionLog! # New session log created for athlete
	sessionLogUpdated(id: ID!): SessionLog! # Session log updated (e.g., AI summary added)

	# Goal subscriptions
	goalAdded(athleteId: ID!): Goal! # New goal created for athlete
	goalUpdated(id: ID!): Goal! # Goal updated (status, progress, etc.)

	# Athlete subscriptions
	athleteUpdated(id: ID!): Athlete! # Athlete information updated
}
